-- CREATE TABLE

CREATE TABLE "ADMIN"."AUTH_GROUP" (
    "ID" NUMBER(11) GENERATED BY DEFAULT ON NULL AS IDENTITY NOT NULL PRIMARY KEY,
	"NAME" NVARCHAR2(150)
);

CREATE TABLE "ATENCION_ATENCION" (
    "ID" NUMBER(11) GENERATED BY DEFAULT ON NULL AS IDENTITY NOT NULL PRIMARY KEY,
    "CODIGO" NVARCHAR2(150) NULL,
    "TOTAL" NUMBER(9, 2) NULL,
    "FECHA" TIMESTAMP NOT NULL,
    "ESTA_ACTIVO" NUMBER(1) NOT NULL CHECK ("ESTA_ACTIVO" IN (0,1)),
    "ESTA_PAGADA" NUMBER(1) NOT NULL CHECK ("ESTA_PAGADA" IN (0,1)),
    "CLIENTE_ID" NUMBER(11) NOT NULL,
    "NUMERO_MESA" NUMBER(11) NOT NULL
);

CREATE TABLE "ATENCION_PEDIDO" (
    "ID" NUMBER(11) GENERATED BY DEFAULT ON NULL AS IDENTITY NOT NULL PRIMARY KEY,
    "ESTADO" NVARCHAR2(20) NULL,
    "FECHA_INGRESO" TIMESTAMP NOT NULL,
    "FECHA_PREPARACION" TIMESTAMP NULL,
    "FECHA_ENTREGA" TIMESTAMP NULL,
    "ATENCION_ID" NUMBER(11) NOT NULL
);

CREATE TABLE "ATENCION_PEDIDO_RECETA" (
    "PEDIDO_ID" NUMBER(11) NOT NULL,
    "RECETA_ID" NUMBER(11) NOT NULL,
    "CANTIDAD" NUMBER(2) NOT NULL
);

CREATE TABLE "CORE_CLIENTE" (
    "ID" NUMBER(11) GENERATED BY DEFAULT ON NULL AS IDENTITY NOT NULL PRIMARY KEY,
    "NOMBRE" NVARCHAR2(100) NULL,
    "TELEFONO" NUMBER(11) NULL,
    "CORREO" NVARCHAR2(255) NULL UNIQUE
);

CREATE TABLE "CORE_MESA" (
    "NUMERO_MESA" NUMBER(11) NOT NULL PRIMARY KEY CHECK ("NUMERO_MESA" >= 0),
    "EN_USO" NUMBER(1) NOT NULL CHECK ("EN_USO" IN (0,1)),
    "ASIENTOS" NUMBER(11) NOT NULL
);

CREATE TABLE "CORE_RESERVACION" (
    "ID" NUMBER(11) GENERATED BY DEFAULT ON NULL AS IDENTITY NOT NULL PRIMARY KEY,
    "FECHA" DATE NOT NULL,
    "ASISTENTES" NUMBER(2) NOT NULL,
    "CODIGO" VARCHAR2(15),
    "ESTADO" VARCHAR2(10) NOT NULL,
    "CLIENTE_ID" NUMBER(11) NOT NULL,
    "FECHA_CONFIRMACION" TIMESTAMP NOT NULL
);

CREATE TABLE "CORE_USER" (
    "ID" NUMBER(11) GENERATED BY DEFAULT ON NULL AS IDENTITY NOT NULL PRIMARY KEY,
    "PASSWORD" NVARCHAR2(128) NULL,
    "LAST_LOGIN" TIMESTAMP NULL,
    "IS_SUPERUSER" NUMBER(1) NOT NULL CHECK ("IS_SUPERUSER" IN (0,1)),
    "USERNAME" NVARCHAR2(150) NULL UNIQUE,
    "FIRST_NAME" NVARCHAR2(150) NULL,
    "LAST_NAME" NVARCHAR2(150) NULL,
    "EMAIL" NVARCHAR2(254) NULL,
    "IS_STAFF" NUMBER(1) NOT NULL CHECK ("IS_STAFF" IN (0,1)),
    "IS_ACTIVE" NUMBER(1) NOT NULL CHECK ("IS_ACTIVE" IN (0,1)),
    "DATE_JOINED" TIMESTAMP NOT NULL
);

CREATE TABLE "CORE_USER_GROUPS" (
    "ID" NUMBER(11) GENERATED BY DEFAULT ON NULL AS IDENTITY NOT NULL PRIMARY KEY,
    "USER_ID" NUMBER(11) NOT NULL,
    "GROUP_ID" NUMBER(11) NOT NULL
);

CREATE TABLE "PRODUCTOS_CATEGORIA" (
    "ID" NUMBER(11) GENERATED BY DEFAULT ON NULL AS IDENTITY NOT NULL PRIMARY KEY,
    "NOMBRE" NVARCHAR2(100) NULL UNIQUE,
    "ESTA_EN_CARTA" NUMBER(1) NOT NULL CHECK ("ESTA_EN_CARTA" IN (0,1))
);

CREATE TABLE "PRODUCTOS_RECETA" (
    "ID" NUMBER(11) GENERATED BY DEFAULT ON NULL AS IDENTITY NOT NULL PRIMARY KEY,
    "NOMBRE" NVARCHAR2(100) NULL UNIQUE,
    "DESCRIPCION" NVARCHAR2(255) NULL,
    "FECHA_INGRESO" TIMESTAMP NOT NULL,
    "PRECIO" NUMBER(9, 2) NOT NULL,
    "ESTA_DISPONIBLE" NUMBER(1) NOT NULL CHECK ("ESTA_DISPONIBLE" IN (0,1)),
    "IMAGEN" NVARCHAR2(100) NULL,
    "CATEGORIA_ID" NUMBER(11) NOT NULL
);

CREATE TABLE "PRODUCTOS_PRODUCTO" (
    "ID" NUMBER(11) GENERATED BY DEFAULT ON NULL AS IDENTITY NOT NULL PRIMARY KEY,
    "NOMBRE" NVARCHAR2(150) NULL UNIQUE,
    "CANTIDAD_STOCK" NUMBER(11) NOT NULL CHECK ("CANTIDAD_STOCK" >= 0),
    "FECHA_INGRESO" TIMESTAMP NOT NULL,
    "ES_VENTA_INDIVIDUAL" NUMBER(1) NOT NULL CHECK ("ES_VENTA_INDIVIDUAL" IN (0,1)),
    "PUNTO_PEDIDO" NUMBER(11) NOT NULL CHECK ("PUNTO_PEDIDO" >= 0),
    "STOCK_MINIMO" NUMBER(11) NOT NULL CHECK ("STOCK_MINIMO" >= 0),
    "STOCK_MAXIMO" NUMBER(11) NOT NULL CHECK ("STOCK_MAXIMO" >= 0),
    "PRECIO_VENTA" NUMBER(9, 2) NOT NULL,
    "PRECIO_COMPRA" NUMBER(9, 2) NOT NULL,
    "IMAGEN" NVARCHAR2(100) NULL,
    "CATEGORIA_ID" NUMBER(11) NOT NULL
);

CREATE TABLE "PRODUCTOS_UNIDAD_MEDIDA" (
    "ID" NUMBER(11) GENERATED BY DEFAULT ON NULL AS IDENTITY NOT NULL PRIMARY KEY,
    "NOMBRE" NVARCHAR2(50) NULL UNIQUE,
    "ABREVIATURA" NVARCHAR2(5) NULL UNIQUE
);

CREATE TABLE "PRODUCTOS_RECETA_PRODUCTOS" (
    "ID" NUMBER(11) GENERATED BY DEFAULT ON NULL AS IDENTITY NOT NULL PRIMARY KEY,
    "RECETA_ID" NUMBER(11) NOT NULL,
    "PRODUCTO_ID" NUMBER(11) NOT NULL
);

-- ALTER TABLE ADD CONSTRAINT

ALTER TABLE "ATENCION_ATENCION" ADD CONSTRAINT "ATENCION__CLIENTE_I_AE73E985_F" FOREIGN KEY ("CLIENTE_ID") REFERENCES "CORE_CLIENTE"("ID") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "ATENCION_ATENCION" ADD CONSTRAINT "ATENCION__NUMERO_ME_A3D32F32_F" FOREIGN KEY ("NUMERO_MESA") REFERENCES "CORE_MESA"("NUMERO_MESA") DEFERRABLE INITIALLY DEFERRED;

ALTER TABLE "ATENCION_PEDIDO" ADD CONSTRAINT "ATENCION__ATENCION__8B49F481_F" FOREIGN KEY ("ATENCION_ID") REFERENCES "ATENCION_ATENCION" ("ID") DEFERRABLE INITIALLY DEFERRED;

ALTER TABLE "PRODUCTOS_PRODUCTO" ADD "UNIDAD_MEDIDA_ID" NUMBER(11) NOT NULL CONSTRAINT "PRODUCTOS_UNIDAD_ME_2510C11E_F" REFERENCES "PRODUCTOS_UNIDAD_MEDIDA"("ID") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "PRODUCTOS_PRODUCTO" ADD CONSTRAINT "PRODUCTOS_CATEGORIA_1FEF506A_F" FOREIGN KEY ("CATEGORIA_ID") REFERENCES "PRODUCTOS_CATEGORIA" ("ID") DEFERRABLE INITIALLY DEFERRED;

ALTER TABLE "PRODUCTOS_RECETA" ADD CONSTRAINT "PRODUCTOS_CATEGORIA_6A4A27C4_F" FOREIGN KEY ("CATEGORIA_ID") REFERENCES "PRODUCTOS_CATEGORIA" ("ID") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "PRODUCTOS_RECETA_PRODUCTOS" ADD CONSTRAINT "PRODUCTOS_RECETA_ID_B0CD0248_U" UNIQUE ("RECETA_ID", "PRODUCTO_ID");
ALTER TABLE "PRODUCTOS_RECETA_PRODUCTOS" ADD CONSTRAINT "PRODUCTOS_RECETA_ID_28D598E3_F" FOREIGN KEY ("RECETA_ID") REFERENCES "PRODUCTOS_RECETA" ("ID") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "PRODUCTOS_RECETA_PRODUCTOS" ADD CONSTRAINT "PRODUCTOS_PRODUCTO__92260A55_F" FOREIGN KEY ("PRODUCTO_ID") REFERENCES "PRODUCTOS_PRODUCTO" ("ID") DEFERRABLE INITIALLY DEFERRED;

-- CREATE INDEX

CREATE INDEX "ATENCION_P_ATENCION_I_8B49F481" ON "ATENCION_PEDIDO" ("ATENCION_ID");
CREATE INDEX "ATENCION_P_GARZON_ID_545FDE2A" ON "ATENCION_PEDIDO" ("GARZON_ID");
CREATE INDEX "ATENCION_A_CLIENTE_ID_AE73E985" ON "ATENCION_ATENCION" ("CLIENTE_ID");
CREATE INDEX "ATENCION_A_NUMERO_MES_A3D32F32" ON "ATENCION_ATENCION" ("NUMERO_MESA");
CREATE INDEX "PRODUCTOS__CATEGORIA__1FEF506A" ON "PRODUCTOS_PRODUCTO" ("CATEGORIA_ID");
CREATE INDEX "PRODUCTOS__CATEGORIA__6A4A27C4" ON "PRODUCTOS_RECETA" ("CATEGORIA_ID");
CREATE INDEX "PRODUCTOS__RECETA_ID_28D598E3" ON "PRODUCTOS_RECETA_PRODUCTOS" ("RECETA_ID");
CREATE INDEX "PRODUCTOS__PRODUCTO_I_92260A55" ON "PRODUCTOS_RECETA_PRODUCTOS" ("PRODUCTO_ID");
CREATE INDEX "PRODUCTOS__UNIDAD_MED_2510C11E" ON "PRODUCTOS_PRODUCTO" ("UNIDAD_MEDIDA_ID");
